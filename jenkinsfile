pipeline {
   agent any

   stages {

       stage('Checkout') {
           steps {
               script {
                   checkout scm
               }
           }
       }

       stage('Test') {
           steps {
               script {
                   bat 'mvn -e clean test -Dmaven.test.failure.ignore=true'
               }
           }
       }

       stage('Publish Allure Report') {
           steps {
               script {
                   bat 'allure generate target/allure-results -o target/allure-report'

                   archiveArtifacts 'target/allure-report/**'

                   allure(
                        includeProperties: false,
                        jdk: '',
                        results: [[path: 'target/allure-results']]
                   )
               }
           }
       }

       stage('Send Discord Notifier') {
            steps {
                script {
                    def message = "# Relatorio de Testes/API Chronos\n"
                    message += "**Branch:** RELEASE\n"
                    message += "**Build:** ${buildNumber}\n"
                    message += "**Status:** ${buildResult}\n"

                    discordSend description: message,
                    webhookURL: "https://discord.com/api/webhooks/1212851937758937209/o5j4_OPhUd-OVY4tJqCteJTbPFQrTHMaE967Ezmi1xzbsFbJdMh3H1IuNkCcpE3wLgBs"
                }
            }
       }
   }
}
